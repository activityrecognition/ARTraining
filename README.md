# Gather data
In order to organize datasets, we created 2 users: __data__ and __validation__. The walls of these users will be part of the dataset.

__data__ wall videos will be divided, with a given proportion, in _validation_ (called testing in libccv) and _training_ datasets.

__validation__ wall videos will be used as a _testing_ dataset.

For including a video in a dataset, follow the steps below:

1. find or create a group with:
     + name that includes the label of the corresponding video you want to send (ex. if the label is __lying__, group name must satisfy the regular expression ```*lying*```).
     + has as member the _dataset_ user (__validation__ or __data__) in which you want to include the video.
2. send the video to the group defined in step 1.

# Downloading videos from Thermix

##### Script:

```python video_downloader.py -e <email>```

##### Usage:

For downloading videos of specific groups of an specific user. It takes the following arguments:
+ _email_ (-e, --email=): thermix user email. (_default:_```None```)
+ _password_ (-p, --password=): thermix user password. (_default:_```aaaaaa```)
+ _output_ (-o, --output=) : path to the directory where the videos will be downloaded. (_default:_```./downloads```)
+ _groups_ (-g, --groups=) : list of group names to download (group names passed here will be downloaded no matters they do not contain any label passed in argument _labels_). (_default:_```[]```)

Ex. ```-g '["group_1_lying","hola_sitting"]'```
+ _labels_ (-l, --labels=) : list of labels that are included in the names of groups to download. (_default:_```'["lying", "sitting", "standing", "indoor", "close up", "outdoor"]'```)

Ex. if the script is run with argument ```-l '["lying", "sitting"]'```, it will download all groups with names that satisfies ```*lying*``` or ```*sitting*```.
+ _thermal_\__modes_ (-t, --thermal_modes=) : list of thermal image modes (tim) that have to be contemplated. (_default:_```'["4_tim]'```)
Thermal modes are:
  + _Thermal Arctic_ (0_tim)
  + _MSX Arctic_ (1_tim)
  + _Thermal Coldest_ (2_tim)
  + _MSX Coldest_ (3_tim)
  + _Thermal Gray_ (4_tim)
  + _MSX Gray_ (5_tim)
  + _Thermal Iron_ (6_tim)
  + _MSX Iron_ (7_tim)
  + _Thermal Contrast_ (8_tim)
  + _MSX Contrast_ (9_tim)
  + _Thermal Rainbow_ (10_tim)
  + _MSX Rainbow_ (11_tim)
  + _Thermal Hottest_ (12_tim)
  + _MSX Hottest_ (14_tim)
  + _RGB_ (15_tim)

Ex. ```-t '["4_tim","6_tim"]'```

All arguments are optional. In case any of them is not passed, the script will use the default value.

The folder architecture created, consist in one folder per group with its name (if 2 o more groups have the same name, each folder will be called _groupName_\__idNumber_). each folder contains as many folders as thermal modes were requested and inside them, the videos are stored.

# Creating training & validation datasets

##### Script:

```python prepare_data_for_training.py```

##### Usage:

For getting frames of videos downloaded by _video_\__downaloader.py_ script and split them in training and validation datasets. It will organize the frames in folders and list training and validation datasets in the format required by __libccv__ to train.

It takes the following arguments:
+ _output_ (-o, --output=) : root path where the dataset will be stored. (_default:_```./dataset```)
+ _input_ (-i, --input=) : root path to the directory that contains videos in the format generated by _video_\__downloader.py_ script. (_default:_```./downloads```)
+ _model_\__name_ (-m, --model_name=): name for the dataset (_default:_```thermix_1```)
+ _testing_\__proportion_ (-p, --testing_proportion=): proportion of the frame that should be part of the validation dataset (from 0 to 1).
+ _labels_ (-l, --labels=): list of labels to include in dataset. (_default:_```'["lying", "sitting", "standing", "indoor", "close up", "outdoor"]'```)
+ _thermal_\__modes_ (-t, --thermal_modes=) : list of thermal image modes (tim) that have to be contemplated. (_default:_```'["4_tim]'```) Check thermal_modes description in the section above for more information.
+ _only_\__dataset_ (--only_dataset): flag for avoiding generate frames. Running the script with this argument will use the frames located in output folder for making training and testing datasets.

The output architecture consist in one folder per _thermal_\__mode_. Each of them, has the following files and folders:
+ _model_\__name_\_files.txt: list of all files part of the dataset. _format_:

  ```x filepath```

  where __filepath__ is the path to a frame associated with the _label_ with id __x__.

+ _model_\__name_\_testing.txt: list of the files part of the validation dataset.
+ _model_\__name_\_training.txt: list of the files part of the training dataset.
+ _model_\__name_\_links.txt: file with labels and its corresponding id. _format_:

  ```i labelName```

  where __i__ is the id associated with the label called __labelName__.

+ _model_\__name_.\_words: all labels of the dataset.
+ one folder per label with name "1",...,"n". Each folder contains one folder per video where the frames are stored.

# Getting videos from datasets

#####Â Script:

```python video_from_images.py```

# Training

##### Script:

```sudo ./script_for_training_CNN.sh modelName```

# Results

###### Python notebook:

```plot_ccv_thermix.ipynb```
